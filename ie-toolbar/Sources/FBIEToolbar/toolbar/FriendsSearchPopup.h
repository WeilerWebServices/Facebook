/**
* Facebook Internet Explorer Toolbar Software License 
* Copyright (c) 2009 Facebook, Inc. 
*
* Permission is hereby granted, free of charge, to any person or organization
* obtaining a copy of the software and accompanying documentation covered by
* this license (which, together with any graphical images included with such
* software, are collectively referred to below as the "Software") to (a) use,
* reproduce, display, distribute, execute, and transmit the Software, (b)
* prepare derivative works of the Software (excluding any graphical images
* included with the Software, which may not be modified or altered), and (c)
* permit third-parties to whom the Software is furnished to do so, all
* subject to the following:
*
* The copyright notices in the Software and this entire statement, including
* the above license grant, this restriction and the following disclaimer,
* must be included in all copies of the Software, in whole or in part, and
* all derivative works of the Software, unless such copies or derivative
* works are solely in the form of machine-executable object code generated by
* a source language processor.  
*
* Facebook, Inc. retains ownership of the Software and all associated
* intellectual property rights.  All rights not expressly granted in this
* license are reserved by Facebook, Inc.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
* SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
* FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
* ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
* DEALINGS IN THE SOFTWARE.
*/

#ifndef FRIENDSSEARCHPOPUP_H
#define FRIENDSSEARCHPOPUP_H

#include "../../util/StringUtils.h"


namespace facebook{

const String sFriendsSearchPopupWindowName = _T("FriendsSearchPopupWindow");

const int kFriendsSearchPopupDefaultHeight = 30;

class SearchPopupHtmlView;

/**
 * class FriendsSearchPopup
 *
 * Implements friends search popup look & functionality.
 * It is used to show popup with friend search results
 */
class FriendsSearchPopup : public CWnd{
  DECLARE_DYNAMIC(FriendsSearchPopup)
public:
  FriendsSearchPopup(void);
  FriendsSearchPopup(HWND parentHwnd);
  virtual ~FriendsSearchPopup(void);
protected:
  DECLARE_MESSAGE_MAP()
public:

  /**
   * close popup
   *
   * @return void
   */

  void closeIt();
  void changeFilter(const String& filter);

  /**
   * cretate popup
   *
   * @param pParent - parent widow class
   * @param pt      - base point for sowing popup filter window
   * @param mode    - empty string or string with filter mode
   * @return void
   */
  BOOL Create(CWnd* pParent, CPoint pt,IWebBrowser2Ptr browser);

  /**
   * Checks whether specified window is our chield
   *
   * @param descendantCandidate - child candidate to check
   * @return true if yes
   */
  bool isWindowOurDescendant(const HWND descendantCandidate) const;

private:
  CRect rect_;           // window rect
  SearchPopupHtmlView* friendsHtmlView_; // friends list html view   
  CRect calculateWindowRect() const;
  HWND parentWindow_;
  CPoint initialLocation_;

  void resize(int height);

  /**
   * On Kill Focus
   *
   * @param   window pointer
   *
   * @return void
   */

  afx_msg void OnKillFocus(CWnd* /*wnd*/);

  /**
   * On Set Focus
   *
   * @param   window pointer
   *
   * @return void
   */

  afx_msg void OnSetFocus(CWnd* /*wnd*/);

  /**
   * OnLButtonUp - On Left Button Up
   *
   * @param   window pointer
   *
   * @return void
   */
  afx_msg void OnLButtonUp(UINT, CPoint cp);

  afx_msg LRESULT onChangeFriendsFilter(WPARAM wParam, LPARAM lParam);

  /**
   * Handler for navigation key. Checks whether pressed
   * key one of the following 'down', 'up', 'pgDown, 'pgUp', 
   * 'home', 'end' and translates it to appropriate call of 
   * We use this tricky technique because ie window(
   * friends view) for unknown reason doesn't want to process
   * keyboard inside sidebar.
   */
  LRESULT onNavigationKeyPressed(WPARAM wParam, LPARAM lParam);

  /**
   * onFocusChange - custome handler to handle mouse clicks 
   *
   * @param wParam - x coordinate of the click
   * @param lParam      - y coordinate of the click
   * @return int - not used
   */
  afx_msg LRESULT onFocusChange(WPARAM wParam, LPARAM lParam);

  /**
   * onContentResize - custome handler to handle html content size changes
   *
   * @param wParam - height of the content
   * @param lParam      - not used
   * @return int - not used
   */
  afx_msg LRESULT onContentResize(WPARAM wParam, LPARAM lParam);
  

};

} // !namespace facebook

#endif // FRIENDSSEARCHPOPUP_H