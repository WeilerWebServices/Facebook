libfbml for Apache 2.x

 Common Public Attribution License Version 1.0.

 The contents of this file are subject to the Common Public Attribution
 License Version 1.0 (the "License") you may not use this file except in 
 compliance with the License. You may obtain a copy of the License at 
 http://developers.facebook.com/fbopen/cpal.html. The License is based
 on the Mozilla Public License Version 1.1 but Sections 14 and 15 have
 been added to cover use of software over a computer network and provide
 for limited attribution for the Original Developer. In addition, Exhibit A
 has been modified to be consistent with Exhibit B. 
 Software distributed under the License is distributed on an "AS IS" basis,
 WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 for the specific language governing rights and limitations under the License.
 The Original Code is Facebook Open Platform.
 The Original Developer is the Initial Developer.
 The Initial Developer of the Original Code is Facebook, Inc.  All portions
 of the code written by Facebook, Inc are
 Copyright 2006-2008 Facebook, Inc. All Rights Reserved.

Overview:

libfbml is a package that provides the basic functionality needed
to parse and render FBML.  libfbml builds both a general C++ library and
a PHP extension that layers on top of the C++ module.  The PHP extension
can then be installed behind Apache so that a collection of PHP functions
are available to your PHP pages.  The build script we provide should
compile, link, and install everything needed for both the C++ and PHP modules.

Downloading Mozilla Dependencies:

The libfbml package depends on firefox-2.0.0.4, which itself requires that
several open source packages be installed.  firefox-2.0.0.4-source.tar.bz2 is
included with this release and resides in the dependencies subdirectory.
Please note that firefox-2.0.0.4 relies on the below products (note that
the URLs are provided purely as a convenience):

         glib-2.14.6.tar.gz (http://ftp.acc.umu.se/pub/GNOME/sources/glib/2.14/glib-2.14.6.tar.gz)
         pkg-config-0.20.tar.gz (ftp://ftp.gtk.org/pub/gtk/v2.10/dependencies/pkg-config-0.20.tar.gz)
         atk-1.9.1.tar.bz2 (ftp://ftp.gtk.org/pub/gtk/v2.10/dependencies/atk-1.9.1.tar.bz2)
         freetype-2.3.4.tar.gz (http://download.savannah.gnu.org/releases/freetype/freetype-2.3.4.tar.gz)
         fontconfig-2.3.97.tar.gz (http://fontconfig.org/release/fontconfig-2.3.97.tar.gz)
         libpng-1.2.25.tar.gz (http://internap.dl.sourceforge.net/sourceforge/libpng/libpng-1.2.25.tar.gz)
         cairo-1.2.6.tar.gz (ftp://ftp.gtk.org/pub/gtk/v2.10/dependencies/cairo-1.2.6.tar.gz)
         tiff-3.7.4.tar.gz (ftp://ftp.gtk.org/pub/gtk/v2.10/dependencies/tiff-3.7.4.tar.gz)
         pango-1.18.4.tar.bz2 (http://ftp.gnome.org/pub/gnome/sources/pango/1.18/pango-1.18.4.tar.bz2)
         gtk+-2.10.13.tar.bz2 (ftp://ftp.gtk.org/pub/gtk/v2.10/gtk+-2.10.13.tar.bz2)
         libIDL-0.8.8.tar.gz (http://ftp.gnome.org/pub/gnome/sources/libIDL/0.8/libIDL-0.8.8.tar.gz)
         libXft-2.1.12.tar.gz (http://xorg.freedesktop.org/releases/individual/lib/libXft-2.1.12.tar.gz)
         xproto-7.0.7.tar.gz (http://xorg.freedesktop.org/releases/individual/proto/xproto-7.0.7.tar.gz)
         xrender-0.8.3.tar.bz2 (http://freeware.sgi.com/source/xrender/xrender-0.8.3.tar.bz2)


Note that if you place these compressed tarballs (don't expand them) in
the dependencies subdirectory alongside firefox-2.0.0.4-source.tar.bz2,
you can use the build.all.py script in the Installation instructions
below to install all of the packages in the correct order.

Installation:

The installation can be managed entirely by the build-all.py script, which sits
at the root of the unzipped, untarred directory. From the command line, type:

        > ./build-all.py

The collection of open source packages will be configured, made, and make
installed automatically.

The libfbml PHP module depends on compilation products generated by Mozilla,
which itself depends on a collection of other open source products.  The build-all.py
script expands and installs all open source components (except firefox, which comes
later) in the order outlined above.

If you have all of the above files in the dependencies folder, then the
build-all.py script will unzip, untar, configure, make, and make install
each and every one of them.

The script then proceeds to build the 2.0.0.4 version of firefox.  Our libfbml
module depends on a collection of modules generated by the compilation of the
firefox.2.0.0.4 source code.  The build-all.py script unzips, untars, configured,
and makes the firefox source, but it stops short of installing it, since it
isn't required in order to build libfbml.

Once firefox has been made, we plant soft links to a subset of .o and .a files
that are relevant to the libfbml make system.  An overwhelming majority
of the header and source files that come with the firefox project are already
included within the src subdirectory.  The current version of libfbml relies
on the Mozilla HTML parser, which was modified to recognize FBML tags and
construct FBML parse trees.

Once the requisite set of archive files have been generated and the soft links
to those files have been laid down, build-all.py compiles, builds, and installs
libfbml as a PHP extension to Apache.  The script should print:

        Build complete.  You'll need to restart Apache before the new PHP extension can be used.

just before it exits.

Changing the Source:

The build-all.py scripts need only be executed once, as its primary purpose
is to build the mozilla parser and to lay down soft links to mozilla libraries
within the libfbml-specified source tree.  As you change the libfbml source,
you only need to interact with the Makefile at the root of the entire project
tree, and phpize/configure/make/install within the ext directory.

Note:

On some systems, we've noticed that the installation of pango-1.18.4 fails to copy
in a specific file in spite of the fact that it should be.  If the build fails
because of complaints that pango wasn't configured to use cairo, then the quick
fix is to copy pangocairo.pc (which resides in the pango-1.18.4 directory) to
/usr/local/lib/pkgconfig.
